# 좋은 단위 테스트의 4대 요소

 가치 있는 테스를 식별하는 것과 가치 있는 테스트를 작성하는 것은 별개의 기술! 따라서, 가치 있는 테스트를 작성하려면 가치 있는 테스트를 식별할 수 있어야 한다.

## (1) 좋은 단위 테스트 4가지 특성

* 회귀 방지
* 리팩터링 내성
* 빠른 피드백
* 유지 보수성

### (1.1) 회귀 방지

 회귀 버그는 이전에 제대로 작동하던 소프트웨어의 코드를 수정(일반적으로 새 기능을 출시한 후)한 후 문제가 생기는 것을 말한다. 회귀 방지는 버그로 인해 회귀하지 않도록 테스트로 검증하는 것이다.

회귀 방지 평가는 다음 사항을 고려해야 한다.
* 테스트 중에 실행되는 코드의 양
* 코드 복잡도
* 코드의 도메인 유의성

### (1.2) 리팩터링 내성

 테스트를 실패(빨간색)로 바꾸지 않고 기본 애플리케이션 코드를 리팩터링 할 수 있는지에 대한 척도를 '리팩터링 내성'이라 한다.
 리팩터링은 결과의 변경 없이 코드의 구조를 변경하는 것으로 코드의 가독성을 높이고 유지보수를 편하게 만든다.

> TDD 사이클은 RED(실패) -> GREEN(성공) -> REFACTOR의 반복이다.

개발을 성공하고 리팩터링을 진행한 후 기능은 이상 없지만 테스트가 빨간색이 뜰 수 있는데, 이러한 상황을 **거짓 양성**(**false positive**)이라고 한다. 거짓 양성은 허위 경보다.

> 단위 테스트의 목표는 프로젝트 성장을 지속 가능하게 하는 것이다.

정리하면 좋은 테스트는 회귀 없이 주기적으로 리팩터링하고 새로운 기능을 추가할 수 있게 한다. 여기에는 두 가지 장점이 있다.

* 기존 기능이 고장 났을 때 테스트가 조기 경고를 제공한다. 이러한 조기 경고 덕분에 결함이 있는 코드가 운영 환경에 배포되기 훨씬 전에 문제를 해결할 수 있다. 운영 환경이었으면 문제를 처리하는 데 훨씬 더 많은 노력이 필요했을 것이다.

* 코드 변경이 회귀로 이어지지 않을 것이라고 확신하게 된다. 이러한 확신이 없으면 리팩터링을 하는 데 주저하게 되고 코드베이스가 나빠질 가능성이 훨씬 높아진다.

> 거짓 양성은 이 두가지 이점을 모두 방해한다.

* 테스트가 타당한 이유 없이 실패하면, 코드 문제에 대응하는 능력과 의지가 희석된다. 시간이 흐르면서 그러한 실패에 익숙해지고 그만큼 신경을 많이 쓰지 않는다. 이내 타당한 실패도 무시하기 시작해 기능이 고장 나도 운영 환경에 들어가게 된다.

* 반면에 거짓 양성이 빈번하면 테스트 스위트에 대한 신뢰가 서서히 떨어지며, 더는 믿을 만한 안전망으로 인식하지 않는다. 즉, 허위 경보로 인식이 나빠진다. 이렇게 신뢰가 부족해지면 리팩터링이 줄어든다. 회귀를 피하려고 코드 변경을 최소한으로 하기 때문이다. 

> 리팩터링 내성을 높이는 방법

테스트와 테스트 대상 시스템(SUT)의 구현 세부 사항이 많이 결합할수록 허위 경보가 더 많이 생긴다. 즉, 구현 세부 사항과 테스트 사이를 떨어뜨리고 최종 사용자의 관점에게 의미 있는 결과만 확인해야 한다. 다른 모든 것은 무시해야 한다.


---

